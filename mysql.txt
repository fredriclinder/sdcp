create database sdcp;
create user 'sdcp'@'localhost' identified by 'sdcp';
grant all on sdcp.* to 'sdcp';
use sdcp;

DROP TABLE IF EXISTS `consoles`;
CREATE TABLE `consoles` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(20) DEFAULT NULL,
  `ip` int(10) unsigned DEFAULT '2130706433',
  PRIMARY KEY (`id`),
  UNIQUE KEY `ip` (`ip`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=latin1;

DROP TABLE IF EXISTS `devices`;
CREATE TABLE `devices` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ip` int(10) unsigned NOT NULL,
  `console_id` int(10) unsigned DEFAULT NULL,
  `console_port` int(10) unsigned DEFAULT NULL,
  `dns_a_id` int(10) unsigned DEFAULT '0',
  `dns_ptr_id` int(10) unsigned DEFAULT '0',
  `hostname` varchar(20) DEFAULT NULL,
  `domain` varchar(20) DEFAULT NULL,
  `fqdn` varchar(20) DEFAULT NULL,
  `graphed` varchar(3) DEFAULT 'no',
  `ipam_id` int(10) unsigned DEFAULT '0',
  `model` varchar(20) DEFAULT NULL,
  `pem0_pdu_id` int(10) unsigned DEFAULT NULL,
  `pem0_pdu_unit` tinyint(3) unsigned DEFAULT '0',
  `pem0_pdu_slot` tinyint(3) unsigned DEFAULT '0',
  `pem1_pdu_id` int(10) unsigned DEFAULT NULL,
  `pem1_pdu_unit` tinyint(3) unsigned DEFAULT '0',
  `pem1_pdu_slot` tinyint(3) unsigned DEFAULT '0',
  `rack_id` int(10) unsigned DEFAULT NULL,
  `rack_unit` tinyint(3) DEFAULT '0',
  `rack_size` tinyint(3) DEFAULT '1',
  `type` varchar(20) DEFAULT NULL,
  `snmp` varchar(20) DEFAULT NULL,
  `mac` bigint(20) unsigned DEFAULT '0',
  `ipam_mask` tinyint(3) unsigned DEFAULT '24',
  `ipam_sub` int(10) unsigned DEFAULT '0',
  `domain_id` int(10) unsigned DEFAULT NULL,
  `subnet_id` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `ip` (`ip`),
  KEY `pem0_pdu_id` (`pem0_pdu_id`),
  KEY `pem1_pdu_id` (`pem1_pdu_id`),
  KEY `rack_id` (`rack_id`),
  KEY `console_id` (`console_id`),
  CONSTRAINT `devices_ibfk_6` FOREIGN KEY (`console_id`) REFERENCES `consoles` (`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `devices_ibfk_3` FOREIGN KEY (`pem0_pdu_id`) REFERENCES `pdus` (`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `devices_ibfk_4` FOREIGN KEY (`pem1_pdu_id`) REFERENCES `pdus` (`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `devices_ibfk_5` FOREIGN KEY (`rack_id`) REFERENCES `racks` (`id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=latin1;

DROP TABLE IF EXISTS `domains`;
CREATE TABLE `domains` (
  `id` int(10) unsigned NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

DROP TABLE IF EXISTS `pdus`;
CREATE TABLE `pdus` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(20) DEFAULT NULL,
  `ip` int(10) unsigned DEFAULT '2130706433',
  `0_slot_name` varchar(10) NOT NULL DEFAULT 'unknown',
  `1_slot_name` varchar(10) NOT NULL DEFAULT 'unknown',
  `0_slot_id` tinyint(3) unsigned NOT NULL DEFAULT '0',
  `1_slot_id` tinyint(3) unsigned NOT NULL DEFAULT '1',
  `slots` tinyint(1) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`),
  UNIQUE KEY `ip` (`ip`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=latin1;

DROP TABLE IF EXISTS `racks`;
CREATE TABLE `racks` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(20) DEFAULT NULL,
  `size` int(10) unsigned DEFAULT NULL,
  `fk_console` int(10) unsigned DEFAULT NULL,
  `fk_pdu_1` int(10) unsigned DEFAULT NULL,
  `fk_pdu_2` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`),
  KEY `fk_console` (`fk_console`),
  KEY `fk_pdu_1` (`fk_pdu_1`),
  KEY `fk_pdu_2` (`fk_pdu_2`),
  CONSTRAINT `racks_ibfk_3` FOREIGN KEY (`fk_pdu_2`) REFERENCES `pdus` (`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `racks_ibfk_1` FOREIGN KEY (`fk_console`) REFERENCES `consoles` (`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `racks_ibfk_2` FOREIGN KEY (`fk_pdu_1`) REFERENCES `pdus` (`id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=latin1;

DROP TABLE IF EXISTS `subnets`;
CREATE TABLE `subnets` (
  `id` int(10) unsigned NOT NULL,
  `subnet` int(10) unsigned NOT NULL,
  `mask` tinyint(3) unsigned NOT NULL DEFAULT '24',
  `subnet_description` text,
  `section_id` int(10) unsigned NOT NULL,
  `section_name` varchar(20) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
