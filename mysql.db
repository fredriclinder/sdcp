--
-- Command: mysqldump -usdcp -psdcp sdcp --no-data --add-drop-database
--
DROP DATABASE IF EXISTS sdcp;
CREATE DATABASE sdcp;
USE sdcp;



DROP TABLE IF EXISTS `bookings`;
CREATE TABLE `bookings` (
  `device_id` int(10) unsigned NOT NULL,
  `user_id` int(10) unsigned NOT NULL,
  `time_start` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`device_id`,`user_id`),
  KEY `fk_user` (`user_id`),
  CONSTRAINT `fk_device` FOREIGN KEY (`device_id`) REFERENCES `devices` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `consoles`;
CREATE TABLE `consoles` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(20) DEFAULT NULL,
  `ip` int(10) unsigned DEFAULT '2130706433',
  `device_id` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `devices`;
CREATE TABLE `devices` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ip` int(10) unsigned NOT NULL,
  `hostname` varchar(40) DEFAULT NULL,
  `a_id` int(10) unsigned DEFAULT '0',
  `a_dom_id` int(10) unsigned DEFAULT NULL,
  `ptr_id` int(10) unsigned DEFAULT '0',
  `subnet_id` int(10) unsigned DEFAULT NULL,
  `type_id` int(10) unsigned DEFAULT NULL,
  `model` varchar(20) DEFAULT NULL,
  `lookup` varchar(40) DEFAULT NULL,
  `snmp` varchar(20) DEFAULT NULL,
  `mac` bigint(20) unsigned DEFAULT '0',
  `vm` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `graph_update` tinyint(1) unsigned DEFAULT '0',
  `graph_proxy` int(10) unsigned DEFAULT '2130706433',
  `comment` text,
  PRIMARY KEY (`id`),
  UNIQUE KEY `ip` (`ip`,`subnet_id`),
  UNIQUE KEY `hostname` (`hostname`,`a_dom_id`),
  KEY `a_dom_id` (`a_dom_id`),
  KEY `subnet_id` (`subnet_id`),
  CONSTRAINT `devices_ibfk_1` FOREIGN KEY (`a_dom_id`) REFERENCES `domains` (`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `devices_ibfk_3` FOREIGN KEY (`subnet_id`) REFERENCES `subnets` (`id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `devicetypes`;
CREATE TABLE `devicetypes` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(20) DEFAULT NULL,
  `base` varchar(40) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `domains`;
CREATE TABLE `domains` (
  `id` int(10) unsigned NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `events`;
CREATE TABLE `events` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `periodic` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `name` varchar(30) DEFAULT NULL,
  `user_id` int(10) unsigned DEFAULT NULL,
  `command` varchar(200) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `pdus`;
CREATE TABLE `pdus` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(20) DEFAULT NULL,
  `ip` int(10) unsigned DEFAULT '2130706433',
  `0_slot_name` varchar(10) NOT NULL DEFAULT 'unknown',
  `1_slot_name` varchar(10) NOT NULL DEFAULT 'unknown',
  `0_slot_id` tinyint(3) unsigned NOT NULL DEFAULT '0',
  `1_slot_id` tinyint(3) unsigned NOT NULL DEFAULT '1',
  `slots` tinyint(1) NOT NULL DEFAULT '0',
  `device_id` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `rackinfo`;
CREATE TABLE `rackinfo` (
  `device_id` int(10) unsigned NOT NULL,
  `rack_unit` tinyint(3) DEFAULT '0',
  `rack_size` tinyint(3) DEFAULT '1',
  `console_id` int(10) unsigned DEFAULT NULL,
  `console_port` int(10) unsigned DEFAULT NULL,
  `pem0_pdu_id` int(10) unsigned DEFAULT NULL,
  `pem0_pdu_unit` tinyint(3) unsigned DEFAULT '0',
  `pem0_pdu_slot` tinyint(3) unsigned DEFAULT '0',
  `pem1_pdu_id` int(10) unsigned DEFAULT NULL,
  `pem1_pdu_unit` tinyint(3) unsigned DEFAULT '0',
  `pem1_pdu_slot` tinyint(3) unsigned DEFAULT '0',
  `rack_id` int(10) unsigned NOT NULL,
  UNIQUE KEY `device_id` (`device_id`),
  KEY `console_id` (`console_id`),
  KEY `pem0_pdu_id` (`pem0_pdu_id`),
  KEY `pem1_pdu_id` (`pem1_pdu_id`),
  KEY `rack_id` (`rack_id`),
  CONSTRAINT `rackinfo_ibfk_1` FOREIGN KEY (`device_id`) REFERENCES `devices` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `rackinfo_ibfk_2` FOREIGN KEY (`console_id`) REFERENCES `consoles` (`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `rackinfo_ibfk_3` FOREIGN KEY (`pem0_pdu_id`) REFERENCES `pdus` (`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `rackinfo_ibfk_4` FOREIGN KEY (`pem1_pdu_id`) REFERENCES `pdus` (`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `rackinfo_ibfk_5` FOREIGN KEY (`rack_id`) REFERENCES `racks` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `racks`;
CREATE TABLE `racks` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(20) DEFAULT NULL,
  `size` int(10) unsigned DEFAULT NULL,
  `fk_console` int(10) unsigned DEFAULT NULL,
  `fk_pdu_1` int(10) unsigned DEFAULT NULL,
  `fk_pdu_2` int(10) unsigned DEFAULT NULL,
  `image_url` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`),
  KEY `fk_console` (`fk_console`),
  KEY `fk_pdu_1` (`fk_pdu_1`),
  KEY `fk_pdu_2` (`fk_pdu_2`),
  CONSTRAINT `racks_ibfk_1` FOREIGN KEY (`fk_console`) REFERENCES `consoles` (`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `racks_ibfk_2` FOREIGN KEY (`fk_pdu_1`) REFERENCES `pdus` (`id`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `racks_ibfk_3` FOREIGN KEY (`fk_pdu_2`) REFERENCES `pdus` (`id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `resources`;
CREATE TABLE `resources` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `title` varchar(25) NOT NULL,
  `href` varchar(200) NOT NULL,
  `icon` varchar(200) DEFAULT NULL,
  `user_id` int(10) unsigned DEFAULT NULL,
  `type` varchar(10) DEFAULT 'bookmark',
  `private` tinyint(1) unsigned DEFAULT '0',
  `inline` tinyint(1) unsigned DEFAULT '0',
  PRIMARY KEY (`id`),
  UNIQUE KEY `user_title` (`title`,`user_id`),
  KEY `user_id` (`user_id`),
  CONSTRAINT `resources_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `subnets`;
CREATE TABLE `subnets` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `subnet` int(10) unsigned NOT NULL,
  `mask` tinyint(3) unsigned NOT NULL DEFAULT '24',
  `gateway` int(10) unsigned DEFAULT NULL,
  `description` text,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `users`;
CREATE TABLE `users` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(20) NOT NULL DEFAULT 'error',
  `email` varchar(40) DEFAULT NULL,
  `alias` varchar(10) DEFAULT NULL,
  `view_public` tinyint(1) unsigned DEFAULT '1',
  `frontpage` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


